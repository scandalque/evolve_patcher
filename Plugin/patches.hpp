#pragma once
#include "config.hpp"

#include <iostream>
#include <vector>

class c_patches
{
public:
	c_patches();
	~c_patches();

	void enable_patches();
	void disable_patches();

	static c_patches* get();

private:
	struct st_patches {
		std::string name;
		std::string module;

		std::uintptr_t addr;

		const char* bytes;
		const char* mask;

		char* new_bytes;
		const std::size_t size;
		char* old_bytes;
	};

	std::string evolve_processing = c_settings::get()->evolve_processing;

	std::vector<st_patches> patches = {
		{
			"textdraw_logotype",
			evolve_processing,
			0u,
			(char*)"\xe8\x00\x00\x00\x00\x80\x3d\x00\x00\x00\x00\x00\x74\x00\x80\x3d",
			(char*)"x????xx?????x?xx",
			(char*)"\x90\x90\x90\x90\x90",
			5u,
			nullptr
		},
			{
			"no_esc_transparency",
			evolve_processing,
			0u,
			(char*)"\x53\x8b\xdc\x83\xec\x00\x83\xe4\x00\x83\xc4\x00\x55\x8b\x6b\x00\x89\x6c\x24\x00\x8b\xec\x6a\x00\x68\x00\x00\x00\x00\x64\xa1\x00\x00\x00\x00\x50\x53\x81\xec\x00\x00\x00\x00\xa1\x00\x00\x00\x00\x33\xc5\x89\x45\x00\x56\x57\x50\x8d\x45\x00\x64\xa3\x00\x00\x00\x00\x8b\x35",
			(char*)"xxxxx?xx?xx?xxx?xxx?xxx?x????xx????xxxx????x????xxxx?xxxxx?xx????xx",
			(char*)"\xC3",
			1u,
			nullptr
		},
			{
			"no_binds",
			evolve_processing,
			0u,
			(char*)"\x83\x38\x00\x0f\x84\x00\x00\x00\x00\xe8\x00\x00\x00\x00\x83\x38\x00\x0f\x84\x00\x00\x00\x00\xe8\x00\x00\x00\x00\x83\x38\x00\x0f\x84\x00\x00\x00\x00\xe8",
			(char*)"xx?xx????x????xx?xx????x????xx?xx????x",
			(char*)"\x31\xC0\x90",
			3u,
			nullptr
		},
			{
			"fix_movement", // privado nops :)
			evolve_processing,
			0u,
			(char*)"\xc7\x45\x00\x00\x00\x00\x00\x8b\x30\x8d\x45\x00\x50\xe8\x00\x00\x00\x00\x51\x8b\x38\x8b\xc4\x2b\xf7\x8b\xce\x89\x38\xe8\x00\x00\x00\x00\x8b\xc4\x8d\x4d\x00\xb2\x00\x89\x38\xe8\x00\x00\x00\x00\x8b\xc4\xb2\x00\xb1\x00\x89\x38\xe8\x00\x00\x00\x00\x8b\xc4\x47\x51\xb2\x00\xb9\x00\x00\x00\x00\xc7\x00\x00\x00\x00\x00\x8b\xc4\x89\x38\xe8\x00\x00\x00\x00\x83\xc4\x00\xc7\x45\x00\x00\x00\x00\x00\x8d\x45\x00\x8d\x4d\x00\x50\xe8\x00\x00\x00\x00\x8d\x4d\x00\xc7\x45\x00\x00\x00\x00\x00\x8b\x30\x8d\x45\x00\x50\xe8\x00\x00\x00\x00\x51\x8b\x38\x8b\xc4\x2b\xf7\x8b\xce\x89\x38\xe8\x00\x00\x00\x00\x8b\xc4\x8d\x4d\x00\xb2\x00\x89\x38\xe8\x00\x00\x00\x00\x8b\xc4\xb2\x00\xb1\x00\x89\x38\xe8\x00\x00\x00\x00\x8b\xc4\x47\x51\xb2\x00\xb9\x00\x00\x00\x00\xc7\x00\x00\x00\x00\x00\x8b\xc4\x89\x38\xe8\x00\x00\x00\x00\x83\xc4\x00\xc7\x45\x00\x00\x00\x00\x00\x8d\x45\x00\x50",
			(char*)"xx?????xxxx?xx????xxxxxxxxxxxx????xxxx?x?xxx????xxx?x?xxx????xxxxx?x????xx????xxxxx????xx?xx?????xx?xx?xx????xx?xx?????xxxx?xx????xxxxxxxxxxxx????xxxx?x?xxx????xxx?x?xxx????xxxxx?x????xx????xxxxx????xx?xx?????xx?x",
			(char*)"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90",
			90u,
			nullptr
		},
			{
			"normal_radar",
			evolve_processing,
			0u,
			(char*)"\x55\x8b\xec\x6a\x00\x68\x00\x00\x00\x00\x64\xa1\x00\x00\x00\x00\x50\x83\xec\x00\xa1\x00\x00\x00\x00\x33\xc5\x89\x45\x00\x53\x56\x50\x8d\x45\x00\x64\xa3\x00\x00\x00\x00\x83\xec",
			(char*)"xxxx?x????xx????xxx?x????xxxx?xxxxx?xx????xx",
			(char*)"\xC3",
			1u,
			nullptr
		},
			{
			"fix_movement",
			"gta_sa.exe",
			0x53E94Cu,
			(char*)"",
			(char*)"",
			(char*)"\x00",
			1u,
			nullptr
		},
			{
			"fix_movement",
			"gta_sa.exe",
			0x745240u,
			(char*)"",
			(char*)"",
			(char*)"\xB0\x00\x90\x90\x90",
			5u,
			nullptr
		},
			{
			"fix_movement",
			"samp.dll",
			0u,
			(char*)"\x51\x56\x57\x8B\xF9\xE8",
			(char*)"xxxxxx",
			(char*)"\xC3",
			1u,
			nullptr
		}
	};
};